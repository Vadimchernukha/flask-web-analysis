<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Analysis Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h2>AI Analysis Tool</h2>

        <div class="file-input-container">
            <input type="file" name="file" id="fileInput" class="file-input">
        </div>



        <button onclick="startAnalysis()">Start Analys</button>
        <button onclick="stopAnalysis()">Stop Analys</button>

        <div class="progress-container">
            <progress id="progressBar" value="0" max="100"></progress>
            <p id="progressText">0% done</p>
            <p id="currentSite">Current domain: Waiting...</p>
        </div>

        <!-- ğŸ“Š ĞÑ‚Ñ‡ĞµÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ -->
        <div class="report-container">
            <h3>ğŸ“Š Report:</h3>
            <p>ğŸ”¹ Uploaded Domains: <span id="domainsLoaded">0</span></p>
            <p>ğŸ”¹ Mass Analyse: <span id="domainsAfterStage1">0</span></p>
            <p>ğŸ”¹ Result: <span id="domainsFinal">0</span></p>
        </div>

        <a href="/download" class="download-btn">Download Results</a>
    </div>

    <!-- âœ… JavaScript Ğ´Ğ»Ñ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ´Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ² -->
    <script>
    let localDomainsLoaded = 0; // âœ… ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ²

    document.getElementById("fileInput").addEventListener("change", function () {
        let file = this.files[0];
        if (!file) return;

        let reader = new FileReader();
        reader.onload = function (event) {
            let content = event.target.result;
            let lines = content.split(/\r\n|\n/).filter(line => line.trim() !== ""); // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
            localDomainsLoaded = lines.length; // âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
            document.getElementById("domainsLoaded").innerText = localDomainsLoaded;

            // âœ… ĞĞ±Ğ½ÑƒĞ»ÑĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ¼
            document.getElementById("domainsAfterStage1").innerText = "0";
            document.getElementById("domainsFinal").innerText = "0";

            console.log("ğŸ“‚ Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½. Ğ”Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ²:", localDomainsLoaded);
        };
        reader.readAsText(file);
    });

    function uploadFile() {
        let fileInput = document.getElementById("fileInput");
        let formData = new FormData();
        formData.append("file", fileInput.files[0]);

        fetch("/upload", { method: "POST", body: formData })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°:", error));
    }

    function startAnalysis() {
        console.log("ĞĞ°Ğ¶Ğ°Ñ‚Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·'");

        // âœ… ĞĞ±Ğ½ÑƒĞ»ÑĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ¼
        document.getElementById("domainsAfterStage1").innerText = "0";
        document.getElementById("domainsFinal").innerText = "0";

        fetch('/start_analysis')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("ĞÑ‚Ğ²ĞµÑ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ°:", data);
                document.getElementById("progressText").innerText = data.message;
                updateProgress();
            })
            .catch(error => console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:", error));
    }

    function stopAnalysis() {
        fetch('/stop_analysis')
            .then(() => console.log("ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"));
    }

    function updateProgress() {
        fetch('/progress')
            .then(response => response.json())
            .then(data => {
                document.getElementById("progressBar").value = data.progress;
                document.getElementById("progressText").innerText = data.progress + "% done";
                document.getElementById("currentSite").innerText = "Current Domain: " + data.current_site;

                // âœ… ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¿Ğ°
                if (data.progress >= 50) {
                    document.getElementById("domainsAfterStage1").innerText = data.domains_after_stage1;
                }
                if (data.progress === 100) {
                    document.getElementById("domainsFinal").innerText = data.domains_final;
                }

                if (data.progress < 100) {
                    setTimeout(updateProgress, 1000);
                }
            })
            .catch(error => console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°:", error));
    }
</script>



</body>
</html>
